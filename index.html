<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DNS Record Checker</title>

  <style>
    /* Page reset */
    html, body { margin: 0; padding: 0; background: #fff; font-family: Arial, sans-serif; }

    /* Viewport wrapper that we’ll size to the scaled table’s height */
    .dns-viewport { width: 100%; overflow: hidden; }

    /* Root holds the fixed-width (desktop) table; we scale this on mobile */
    .dns-root { margin: 0; transform-origin: top left; }

    /* Headline */
    h2 { margin: 0 0 12px 0; font-size: 18px; font-weight: 700; }

    /* Table styles (desktop layout) */
    table { border-collapse: collapse; width: 980px; /* natural width, will be measured dynamically too */ }
    th, td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 14px; }
    thead th { background: #eee; }

    /* Status strip */
    .status { margin-top: 12px; padding: 10px; text-align: center; color: #fff; font-weight: 700; }
    .status.ok  { background: #00a651; }     /* green */
    .status.bad { background: #d50000; }     /* red  */
  </style>
</head>
<body>
  <div class="dns-viewport">
    <div class="dns-root">
      <h2 id="domain">DNS Record Confirmation</h2>

      <table id="dns-table">
        <thead>
          <tr>
            <th rowspan="2">DNS Record</th>
            <th colspan="2">Expected</th>
            <th colspan="2">Actual</th>
          </tr>
          <tr>
            <th>Value</th>
            <th>Data</th>
            <th>Value</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A</td>
            <td>@</td>
            <td id="expA"></td>
            <td>@</td>
            <td id="actA">—</td>
          </tr>
          <tr>
            <td>CNAME</td>
            <td id="cnameHostCell">www</td>
            <td id="expC"></td>
            <td id="actCnameHost">www</td>
            <td id="actC">—</td>
          </tr>
        </tbody>
      </table>

      <div id="status" class="status">Checking DNS…</div>
    </div>
  </div>

  <script>
    /* ---------------- Params ---------------- */
    const q = new URLSearchParams(location.search);
    const domain     = (q.get('domain')     || '').trim() || 'example.com';
    const expectedA  = (q.get('expectedA')  || '').trim() || '93.184.216.34';
    const expectedC  = (q.get('expectedC')  || '').trim() || 'example.com';
    const cnameHost  = (q.get('cnameHost')  || '').trim() || 'www';
    const forceTable = q.get('desktop') === '1'; // optional flag if you ever need it

    /* Populate static fields */
    document.getElementById('domain').textContent = domain;
    document.getElementById('expA').textContent   = expectedA;
    document.getElementById('expC').textContent   = expectedC;
    document.getElementById('cnameHostCell').textContent = cnameHost;
    document.getElementById('actCnameHost').textContent  = cnameHost;

    /* ---------------- DNS over HTTPS (Cloudflare) ---------------- */
    async function doh(name, type) {
      const url = `https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(name)}&type=${type}`;
      const res = await fetch(url, { headers: { 'accept': 'application/dns-json' } });
      if (!res.ok) return [];
      const data = await res.json();
      return (data.Answer || []).map(a => a.data);
    }

    (async function run() {
      const statusEl = document.getElementById('status');
      try {
        // A record for apex
        const aAns = await doh(domain, 'A');
        const liveA = aAns.find(v => /^\d+\.\d+\.\d+\.\d+$/.test(v)) || 'N/A';
        document.getElementById('actA').textContent = liveA;

        // CNAME for host.domain
        const cAns = await doh(`${cnameHost}.${domain}`, 'CNAME');
        const liveC = cAns.length ? cAns[0].replace(/\.$/, '').toLowerCase() : 'N/A';
        document.getElementById('actC').textContent = liveC;

        // Compare (case-insensitive for CNAME)
        const ok = (liveA === expectedA) &&
                   (liveC !== 'N/A' && liveC === expectedC.toLowerCase());

        statusEl.textContent = ok ? "Your DNS Records are correct" : "Your DNS Records are NOT correct";
        statusEl.className = 'status ' + (ok ? 'ok' : 'bad');
      } catch (e) {
        statusEl.textContent = "Error checking DNS";
        statusEl.className = 'status bad';
      } finally {
        // After content renders, scale to fit small viewports
        requestAnimationFrame(scaleToFit);
      }
    })();

    /* ---------------- Auto-scale table to fit iframe width ----------------
       - Keeps table layout everywhere (no stacked mobile)
       - Avoids horizontal scrolling in a narrow iframe
       ------------------------------------------------------------------- */
    function scaleToFit() {
      const vp   = document.querySelector('.dns-viewport');
      const root = document.querySelector('.dns-root');
      const table = document.getElementById('dns-table');
      if (!vp || !root || !table) return;

      // Temporarily remove transform to measure natural width/height
      const prev = root.style.transform;
      root.style.transform = 'none';

      // Natural (desktop) width of the table block
      const naturalWidth = table.scrollWidth;         // e.g., ~980
      const viewportWidth = vp.clientWidth || window.innerWidth;

      // Scale down only if needed
      const scale = Math.min(1, viewportWidth / naturalWidth);

      root.style.transform = `scale(${scale})`;

      // Update viewport height so the iframe shows the whole (scaled) content
      const rect = root.getBoundingClientRect();
      vp.style.height = rect.height + 'px';

      // Restore transform var just in case (kept as is now)
      // root.style.transform = prev;  // (not needed)
    }

    // Recompute on resize/orientation changes
    window.addEventListener('resize', () => { requestAnimationFrame(scaleToFit); });
  </script>
</body>
</html>





